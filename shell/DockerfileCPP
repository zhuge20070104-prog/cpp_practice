# 使用 ubuntu 作为基础镜像
FROM ubuntu:latest

# 设置环境变量 DEBIAN_FRONTEND 为非交互模式
ENV DEBIAN_FRONTEND=noninteractive

# 更新 apt 并安装必要的软件包
RUN apt-get update && apt-get install -y \
    build-essential \
    cmake \
    python3 \
    python3-pip \
    git \
    llvm \
    clang \
    && rm -rf /var/lib/apt/lists/*

# 安装 Jupyter Notebook
RUN pip3 install --upgrade pip && \
    pip3 install jupyter

# 安装 xeus-cling C++ 内核
RUN git clone https://github.com/jupyter-xeus/xeus-cling.git && \
    mkdir -p xeus-cling/build && \
    cd xeus-cling/build && \
    cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_PREFIX_PATH=/usr/lib/llvm-13 .. && \
    make && \
    make install && \
    cd ../.. && \
    rm -rf xeus-cling

# 创建工作目录
WORKDIR /notebooks

# 暴露 Jupyter Notebook 端口
EXPOSE 8888

# 启动 Jupyter Notebook
CMD ["jupyter", "notebook", "--ip=0.0.0.0", "--no-browser", "--allow-root"]
